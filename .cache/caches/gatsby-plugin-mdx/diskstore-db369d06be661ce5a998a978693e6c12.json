{"expireTime":9007200872306493000,"key":"gatsby-plugin-mdx-entire-payload-9a68961a07dc1186f7dcd9851dabfcd8-","val":{"mdast":{"type":"root","children":[{"type":"paragraph","children":[{"type":"text","value":"When trading from a smart contract, the most important thing to keep in mind is that access to an external price source is ","position":{"start":{"line":2,"column":1,"offset":2},"end":{"line":2,"column":124,"offset":125},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"required","position":{"start":{"line":2,"column":125,"offset":126},"end":{"line":2,"column":133,"offset":134},"indent":[]}}],"position":{"start":{"line":2,"column":124,"offset":125},"end":{"line":2,"column":134,"offset":135},"indent":[]}},{"type":"text","value":". Without this, trades can be frontrun for considerable loss.","position":{"start":{"line":2,"column":134,"offset":135},"end":{"line":2,"column":195,"offset":196},"indent":[]}}],"position":{"start":{"line":2,"column":1,"offset":2},"end":{"line":2,"column":195,"offset":196},"indent":[]}},{"type":"paragraph","children":[{"type":"emphasis","children":[{"type":"text","value":"Read ","position":{"start":{"line":4,"column":2,"offset":201},"end":{"line":4,"column":7,"offset":206},"indent":[]}},{"type":"link","title":null,"url":"#safety-considerations","children":[{"type":"text","value":"safety considerations","position":{"start":{"line":4,"column":8,"offset":207},"end":{"line":4,"column":29,"offset":228},"indent":[]}}],"position":{"start":{"line":4,"column":7,"offset":206},"end":{"line":4,"column":54,"offset":253},"indent":[]}},{"type":"text","value":" for more.","position":{"start":{"line":4,"column":54,"offset":253},"end":{"line":4,"column":64,"offset":263},"indent":[]}}],"position":{"start":{"line":4,"column":1,"offset":200},"end":{"line":4,"column":65,"offset":264},"indent":[]}}],"position":{"start":{"line":4,"column":1,"offset":200},"end":{"line":4,"column":65,"offset":264},"indent":[]}},{"type":"heading","depth":1,"children":[{"type":"text","value":"Using the Router","position":{"start":{"line":6,"column":3,"offset":270},"end":{"line":6,"column":19,"offset":286},"indent":[]}}],"position":{"start":{"line":6,"column":1,"offset":268},"end":{"line":6,"column":19,"offset":286},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The easiest way to safely swap tokens is to use the ","position":{"start":{"line":8,"column":1,"offset":290},"end":{"line":8,"column":53,"offset":342},"indent":[]}},{"type":"jsx","value":"<Link to='/docs/v1/smart-contracts/router02'>","position":{"start":{"line":8,"column":53,"offset":342},"end":{"line":8,"column":98,"offset":387},"indent":[]}},{"type":"text","value":"router","position":{"start":{"line":8,"column":98,"offset":387},"end":{"line":8,"column":104,"offset":393},"indent":[]}},{"type":"jsx","value":"</Link>","position":{"start":{"line":8,"column":104,"offset":393},"end":{"line":8,"column":111,"offset":400},"indent":[]}},{"type":"text","value":", which provides a variety of methods to safely swap to and from different assets. You'll notice that there is a function for each permutation of swapping to/from an exact amount of ETH/tokens.","position":{"start":{"line":8,"column":111,"offset":400},"end":{"line":8,"column":304,"offset":593},"indent":[]}}],"position":{"start":{"line":8,"column":1,"offset":290},"end":{"line":8,"column":304,"offset":593},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"First you must use an external price source to calculate the safety parameters for the function you'd like to call. This is either a minimum amount received when selling an exact input or the maximum amount you are willing to pay when a buying an exact output amount","position":{"start":{"line":10,"column":1,"offset":597},"end":{"line":10,"column":267,"offset":863},"indent":[]}}],"position":{"start":{"line":10,"column":1,"offset":597},"end":{"line":10,"column":267,"offset":863},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"It is also important to ensure that your contract controls enough ETH/tokens to make the swap, and has granted approval to the router to withdraw this many tokens.","position":{"start":{"line":12,"column":1,"offset":867},"end":{"line":12,"column":164,"offset":1030},"indent":[]}}],"position":{"start":{"line":12,"column":1,"offset":867},"end":{"line":12,"column":164,"offset":1030},"indent":[]}},{"type":"paragraph","children":[{"type":"emphasis","children":[{"type":"text","value":"Check out the ","position":{"start":{"line":14,"column":2,"offset":1035},"end":{"line":14,"column":16,"offset":1049},"indent":[]}},{"type":"jsx","value":"<Link to='/docs/v1/advanced-topics/pricing/#pricing-trades'>","position":{"start":{"line":14,"column":16,"offset":1049},"end":{"line":14,"column":76,"offset":1109},"indent":[]}},{"type":"text","value":"Pricing","position":{"start":{"line":14,"column":76,"offset":1109},"end":{"line":14,"column":83,"offset":1116},"indent":[]}},{"type":"jsx","value":"</Link>","position":{"start":{"line":14,"column":83,"offset":1116},"end":{"line":14,"column":90,"offset":1123},"indent":[]}},{"type":"text","value":" page for a more in depth discussion on getting prices.","position":{"start":{"line":14,"column":90,"offset":1123},"end":{"line":14,"column":145,"offset":1178},"indent":[]}}],"position":{"start":{"line":14,"column":1,"offset":1034},"end":{"line":14,"column":146,"offset":1179},"indent":[]}}],"position":{"start":{"line":14,"column":1,"offset":1034},"end":{"line":14,"column":146,"offset":1179},"indent":[]}},{"type":"heading","depth":1,"children":[{"type":"text","value":"Example","position":{"start":{"line":16,"column":3,"offset":1185},"end":{"line":16,"column":10,"offset":1192},"indent":[]}}],"position":{"start":{"line":16,"column":1,"offset":1183},"end":{"line":16,"column":10,"offset":1192},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Imagine you want to swap 50 DAI for as much ETH as possible from your smart contract.","position":{"start":{"line":18,"column":1,"offset":1196},"end":{"line":18,"column":86,"offset":1281},"indent":[]}}],"position":{"start":{"line":18,"column":1,"offset":1196},"end":{"line":18,"column":86,"offset":1281},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"transferFrom","position":{"start":{"line":20,"column":4,"offset":1288},"end":{"line":20,"column":16,"offset":1300},"indent":[]}}],"position":{"start":{"line":20,"column":1,"offset":1285},"end":{"line":20,"column":16,"offset":1300},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Before swapping, our smart contracts needs to be in control of 50 DAI. The easiest way to accomplish this is by calling ","position":{"start":{"line":22,"column":1,"offset":1304},"end":{"line":22,"column":121,"offset":1424},"indent":[]}},{"type":"inlineCode","value":"transferFrom","position":{"start":{"line":22,"column":121,"offset":1424},"end":{"line":22,"column":135,"offset":1438},"indent":[]}},{"type":"text","value":" on DAI with the owner set to ","position":{"start":{"line":22,"column":135,"offset":1438},"end":{"line":22,"column":165,"offset":1468},"indent":[]}},{"type":"inlineCode","value":"msg.sender","position":{"start":{"line":22,"column":165,"offset":1468},"end":{"line":22,"column":177,"offset":1480},"indent":[]}},{"type":"text","value":":","position":{"start":{"line":22,"column":177,"offset":1480},"end":{"line":22,"column":178,"offset":1481},"indent":[]}}],"position":{"start":{"line":22,"column":1,"offset":1304},"end":{"line":22,"column":178,"offset":1481},"indent":[]}},{"type":"code","lang":"solidity","meta":null,"value":"uint amountIn = 50 * 10 ** DAI.decimals();\nrequire(DAI.transferFrom(msg.sender, address(this), amountIn), 'transferFrom failed.');","position":{"start":{"line":24,"column":1,"offset":1485},"end":{"line":27,"column":4,"offset":1634},"indent":[1,1,1]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"approve","position":{"start":{"line":29,"column":4,"offset":1641},"end":{"line":29,"column":11,"offset":1648},"indent":[]}}],"position":{"start":{"line":29,"column":1,"offset":1638},"end":{"line":29,"column":11,"offset":1648},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Now that our contract owns 50 DAI, we need to approve to the ","position":{"start":{"line":31,"column":1,"offset":1652},"end":{"line":31,"column":62,"offset":1713},"indent":[]}},{"type":"jsx","value":"<Link to='/docs/v1/smart-contracts/router02'>","position":{"start":{"line":31,"column":62,"offset":1713},"end":{"line":31,"column":107,"offset":1758},"indent":[]}},{"type":"text","value":"router","position":{"start":{"line":31,"column":107,"offset":1758},"end":{"line":31,"column":113,"offset":1764},"indent":[]}},{"type":"jsx","value":"</Link>","position":{"start":{"line":31,"column":113,"offset":1764},"end":{"line":31,"column":120,"offset":1771},"indent":[]}},{"type":"text","value":" to withdraw this DAI:","position":{"start":{"line":31,"column":120,"offset":1771},"end":{"line":31,"column":142,"offset":1793},"indent":[]}}],"position":{"start":{"line":31,"column":1,"offset":1652},"end":{"line":31,"column":142,"offset":1793},"indent":[]}},{"type":"code","lang":"solidity","meta":null,"value":"require(DAI.approve(address(KwikswapV1Router02), amountIn), 'approve failed.');","position":{"start":{"line":33,"column":1,"offset":1797},"end":{"line":35,"column":4,"offset":1894},"indent":[1,1]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"swapExactTokensForETH","position":{"start":{"line":37,"column":4,"offset":1901},"end":{"line":37,"column":25,"offset":1922},"indent":[]}}],"position":{"start":{"line":37,"column":1,"offset":1898},"end":{"line":37,"column":25,"offset":1922},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Now we're ready to swap:","position":{"start":{"line":39,"column":1,"offset":1926},"end":{"line":39,"column":25,"offset":1950},"indent":[]}}],"position":{"start":{"line":39,"column":1,"offset":1926},"end":{"line":39,"column":25,"offset":1950},"indent":[]}},{"type":"code","lang":"solidity","meta":null,"value":"// amountOutMin must be retrieved from an oracle of some kind\naddress[] memory path = new address[](2);\npath[0] = address(DAI);\npath[1] = KwikswapV1Router02.WETH();\nKwikswapV1Router02.swapExactTokensForETH(amountIn, amountOutMin, path, msg.sender, block.timestamp);","position":{"start":{"line":41,"column":1,"offset":1954},"end":{"line":47,"column":4,"offset":2241},"indent":[1,1,1,1,1,1]}},{"type":"heading","depth":1,"children":[{"type":"text","value":"Safety Considerations","position":{"start":{"line":49,"column":3,"offset":2247},"end":{"line":49,"column":24,"offset":2268},"indent":[]}}],"position":{"start":{"line":49,"column":1,"offset":2245},"end":{"line":49,"column":24,"offset":2268},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Because Ethereum transactions occur in an adversarial environment, smart contracts that do not perform safety checks ","position":{"start":{"line":51,"column":1,"offset":2272},"end":{"line":51,"column":118,"offset":2389},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"can be exploited for profit","position":{"start":{"line":51,"column":119,"offset":2390},"end":{"line":51,"column":146,"offset":2417},"indent":[]}}],"position":{"start":{"line":51,"column":118,"offset":2389},"end":{"line":51,"column":147,"offset":2418},"indent":[]}},{"type":"text","value":". If a smart contract assumes that the current price on Kwikswap is a \"fair\" price without performing safety checks, ","position":{"start":{"line":51,"column":147,"offset":2418},"end":{"line":51,"column":264,"offset":2535},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"it is vulnerable to manipulation","position":{"start":{"line":51,"column":265,"offset":2536},"end":{"line":51,"column":297,"offset":2568},"indent":[]}}],"position":{"start":{"line":51,"column":264,"offset":2535},"end":{"line":51,"column":298,"offset":2569},"indent":[]}},{"type":"text","value":". A bad actor could e.g. easily insert transactions before and after the swap (a \"sandwich\" attack) causing the smart contract to trade at a much worse price, profit from this at the trader's expense, and then return the contracts to their original state. (One important caveat is that these types of attacks are mitigated by trading in extremely liquid pools, and/or at low values.)","position":{"start":{"line":51,"column":298,"offset":2569},"end":{"line":51,"column":681,"offset":2952},"indent":[]}}],"position":{"start":{"line":51,"column":1,"offset":2272},"end":{"line":51,"column":681,"offset":2952},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The best way to protect against these attacks is to use an external price feed or \"price oracle\". The best \"oracle\" is simply ","position":{"start":{"line":53,"column":1,"offset":2956},"end":{"line":53,"column":127,"offset":3082},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"traders' off-chain observation of the current price","position":{"start":{"line":53,"column":128,"offset":3083},"end":{"line":53,"column":179,"offset":3134},"indent":[]}}],"position":{"start":{"line":53,"column":127,"offset":3082},"end":{"line":53,"column":180,"offset":3135},"indent":[]}},{"type":"text","value":", which can be passed into the trade as a safety check. This strategy is best for situations ","position":{"start":{"line":53,"column":180,"offset":3135},"end":{"line":53,"column":273,"offset":3228},"indent":[]}},{"type":"emphasis","children":[{"type":"text","value":"where users initiate trades on their own behalf","position":{"start":{"line":53,"column":274,"offset":3229},"end":{"line":53,"column":321,"offset":3276},"indent":[]}}],"position":{"start":{"line":53,"column":273,"offset":3228},"end":{"line":53,"column":322,"offset":3277},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":53,"column":322,"offset":3277},"end":{"line":53,"column":323,"offset":3278},"indent":[]}}],"position":{"start":{"line":53,"column":1,"offset":2956},"end":{"line":53,"column":323,"offset":3278},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"However, when an off-chain price can't be used, an on-chain oracle should be used instead. Determining the best oracle for a given situation is a not part of this guide, but for more details on the Kwikswap approach to oracles, see ","position":{"start":{"line":55,"column":1,"offset":3282},"end":{"line":55,"column":233,"offset":3514},"indent":[]}},{"type":"jsx","value":"<Link to='/docs/v1/core-concepts/oracles'>","position":{"start":{"line":55,"column":233,"offset":3514},"end":{"line":55,"column":275,"offset":3556},"indent":[]}},{"type":"text","value":"Oracles","position":{"start":{"line":55,"column":275,"offset":3556},"end":{"line":55,"column":282,"offset":3563},"indent":[]}},{"type":"jsx","value":"</Link>","position":{"start":{"line":55,"column":282,"offset":3563},"end":{"line":55,"column":289,"offset":3570},"indent":[]}},{"type":"text","value":".","position":{"start":{"line":55,"column":289,"offset":3570},"end":{"line":55,"column":290,"offset":3571},"indent":[]}}],"position":{"start":{"line":55,"column":1,"offset":3282},"end":{"line":55,"column":290,"offset":3571},"indent":[]}},{"type":"export","value":"export const _frontmatter = {\"title\":\"Implement a Swap\",\"tags\":\"developer-guides, documentation\"}","position":{"start":{"line":58,"column":1,"offset":3575},"end":{"line":58,"column":98,"offset":3672},"indent":[]}}],"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":58,"column":98,"offset":3672}}},"scopeImports":["import * as React from 'react'"],"scopeIdentifiers":["React"],"body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Implement a Swap\",\n  \"tags\": \"developer-guides, documentation\"\n};\n\nvar makeShortcode = function makeShortcode(name) {\n  return function MDXDefaultShortcode(props) {\n    console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n    return mdx(\"div\", props);\n  };\n};\n\nvar Link = makeShortcode(\"Link\");\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"When trading from a smart contract, the most important thing to keep in mind is that access to an external price source is \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"required\"), \". Without this, trades can be frontrun for considerable loss.\"), mdx(\"p\", null, mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Read \", mdx(\"a\", {\n    parentName: \"em\",\n    \"href\": \"#safety-considerations\"\n  }, \"safety considerations\"), \" for more.\")), mdx(\"h1\", {\n    \"id\": \"using-the-router\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h1\",\n    \"href\": \"#using-the-router\",\n    \"aria-label\": \"using the router permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Using the Router\"), mdx(\"p\", null, \"The easiest way to safely swap tokens is to use the \", mdx(Link, {\n    to: \"/docs/v1/smart-contracts/router02\",\n    mdxType: \"Link\"\n  }, \"router\"), \", which provides a variety of methods to safely swap to and from different assets. You\\u2019ll notice that there is a function for each permutation of swapping to/from an exact amount of ETH/tokens.\"), mdx(\"p\", null, \"First you must use an external price source to calculate the safety parameters for the function you\\u2019d like to call. This is either a minimum amount received when selling an exact input or the maximum amount you are willing to pay when a buying an exact output amount\"), mdx(\"p\", null, \"It is also important to ensure that your contract controls enough ETH/tokens to make the swap, and has granted approval to the router to withdraw this many tokens.\"), mdx(\"p\", null, mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Check out the \", mdx(Link, {\n    to: \"/docs/v1/advanced-topics/pricing/#pricing-trades\",\n    mdxType: \"Link\"\n  }, \"Pricing\"), \" page for a more in depth discussion on getting prices.\")), mdx(\"h1\", {\n    \"id\": \"example\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h1\",\n    \"href\": \"#example\",\n    \"aria-label\": \"example permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Example\"), mdx(\"p\", null, \"Imagine you want to swap 50 DAI for as much ETH as possible from your smart contract.\"), mdx(\"h2\", {\n    \"id\": \"transferfrom\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#transferfrom\",\n    \"aria-label\": \"transferfrom permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"transferFrom\"), mdx(\"p\", null, \"Before swapping, our smart contracts needs to be in control of 50 DAI. The easiest way to accomplish this is by calling \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"transferFrom\"), \" on DAI with the owner set to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"msg.sender\"), \":\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-solidity\"\n  }, \"uint amountIn = 50 * 10 ** DAI.decimals();\\nrequire(DAI.transferFrom(msg.sender, address(this), amountIn), 'transferFrom failed.');\\n\")), mdx(\"h2\", {\n    \"id\": \"approve\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#approve\",\n    \"aria-label\": \"approve permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"approve\"), mdx(\"p\", null, \"Now that our contract owns 50 DAI, we need to approve to the \", mdx(Link, {\n    to: \"/docs/v1/smart-contracts/router02\",\n    mdxType: \"Link\"\n  }, \"router\"), \" to withdraw this DAI:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-solidity\"\n  }, \"require(DAI.approve(address(KwikswapV1Router02), amountIn), 'approve failed.');\\n\")), mdx(\"h2\", {\n    \"id\": \"swapexacttokensforeth\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#swapexacttokensforeth\",\n    \"aria-label\": \"swapexacttokensforeth permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"swapExactTokensForETH\"), mdx(\"p\", null, \"Now we\\u2019re ready to swap:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-solidity\"\n  }, \"// amountOutMin must be retrieved from an oracle of some kind\\naddress[] memory path = new address[](2);\\npath[0] = address(DAI);\\npath[1] = KwikswapV1Router02.WETH();\\nKwikswapV1Router02.swapExactTokensForETH(amountIn, amountOutMin, path, msg.sender, block.timestamp);\\n\")), mdx(\"h1\", {\n    \"id\": \"safety-considerations\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h1\",\n    \"href\": \"#safety-considerations\",\n    \"aria-label\": \"safety considerations permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Safety Considerations\"), mdx(\"p\", null, \"Because Ethereum transactions occur in an adversarial environment, smart contracts that do not perform safety checks \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"can be exploited for profit\"), \". If a smart contract assumes that the current price on Kwikswap is a \\u201Cfair\\u201D price without performing safety checks, \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"it is vulnerable to manipulation\"), \". A bad actor could e.g. easily insert transactions before and after the swap (a \\u201Csandwich\\u201D attack) causing the smart contract to trade at a much worse price, profit from this at the trader\\u2019s expense, and then return the contracts to their original state. (One important caveat is that these types of attacks are mitigated by trading in extremely liquid pools, and/or at low values.)\"), mdx(\"p\", null, \"The best way to protect against these attacks is to use an external price feed or \\u201Cprice oracle\\u201D. The best \\u201Coracle\\u201D is simply \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"traders\\u2019 off-chain observation of the current price\"), \", which can be passed into the trade as a safety check. This strategy is best for situations \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"where users initiate trades on their own behalf\"), \".\"), mdx(\"p\", null, \"However, when an off-chain price can\\u2019t be used, an on-chain oracle should be used instead. Determining the best oracle for a given situation is a not part of this guide, but for more details on the Kwikswap approach to oracles, see \", mdx(Link, {\n    to: \"/docs/v1/core-concepts/oracles\",\n    mdxType: \"Link\"\n  }, \"Oracles\"), \".\"));\n}\n;\nMDXContent.isMDXComponent = true;","rawMDXOutput":"/* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\nexport const _frontmatter = {\n  \"title\": \"Implement a Swap\",\n  \"tags\": \"developer-guides, documentation\"\n};\nconst makeShortcode = name => function MDXDefaultShortcode(props) {\n      console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\")\n      return <div {...props}/>\n    };\nconst Link = makeShortcode(\"Link\");\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = \"wrapper\"\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n    <p>{`When trading from a smart contract, the most important thing to keep in mind is that access to an external price source is `}<em parentName=\"p\">{`required`}</em>{`. Without this, trades can be frontrun for considerable loss.`}</p>\n    <p><em parentName=\"p\">{`Read `}<a parentName=\"em\" {...{\n          \"href\": \"#safety-considerations\"\n        }}>{`safety considerations`}</a>{` for more.`}</em></p>\n    <h1 {...{\n      \"id\": \"using-the-router\",\n      \"style\": {\n        \"position\": \"relative\"\n      }\n    }}><a parentName=\"h1\" {...{\n        \"href\": \"#using-the-router\",\n        \"aria-label\": \"using the router permalink\",\n        \"className\": \"anchor before\"\n      }}><svg parentName=\"a\" {...{\n          \"aria-hidden\": \"true\",\n          \"focusable\": \"false\",\n          \"height\": \"16\",\n          \"version\": \"1.1\",\n          \"viewBox\": \"0 0 16 16\",\n          \"width\": \"16\"\n        }}><path parentName=\"svg\" {...{\n            \"fillRule\": \"evenodd\",\n            \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n          }}></path></svg></a>{`Using the Router`}</h1>\n    <p>{`The easiest way to safely swap tokens is to use the `}<Link to='/docs/v1/smart-contracts/router02' mdxType=\"Link\">{`router`}</Link>{`, which provides a variety of methods to safely swap to and from different assets. You’ll notice that there is a function for each permutation of swapping to/from an exact amount of ETH/tokens.`}</p>\n    <p>{`First you must use an external price source to calculate the safety parameters for the function you’d like to call. This is either a minimum amount received when selling an exact input or the maximum amount you are willing to pay when a buying an exact output amount`}</p>\n    <p>{`It is also important to ensure that your contract controls enough ETH/tokens to make the swap, and has granted approval to the router to withdraw this many tokens.`}</p>\n    <p><em parentName=\"p\">{`Check out the `}<Link to='/docs/v1/advanced-topics/pricing/#pricing-trades' mdxType=\"Link\">{`Pricing`}</Link>{` page for a more in depth discussion on getting prices.`}</em></p>\n    <h1 {...{\n      \"id\": \"example\",\n      \"style\": {\n        \"position\": \"relative\"\n      }\n    }}><a parentName=\"h1\" {...{\n        \"href\": \"#example\",\n        \"aria-label\": \"example permalink\",\n        \"className\": \"anchor before\"\n      }}><svg parentName=\"a\" {...{\n          \"aria-hidden\": \"true\",\n          \"focusable\": \"false\",\n          \"height\": \"16\",\n          \"version\": \"1.1\",\n          \"viewBox\": \"0 0 16 16\",\n          \"width\": \"16\"\n        }}><path parentName=\"svg\" {...{\n            \"fillRule\": \"evenodd\",\n            \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n          }}></path></svg></a>{`Example`}</h1>\n    <p>{`Imagine you want to swap 50 DAI for as much ETH as possible from your smart contract.`}</p>\n    <h2 {...{\n      \"id\": \"transferfrom\",\n      \"style\": {\n        \"position\": \"relative\"\n      }\n    }}><a parentName=\"h2\" {...{\n        \"href\": \"#transferfrom\",\n        \"aria-label\": \"transferfrom permalink\",\n        \"className\": \"anchor before\"\n      }}><svg parentName=\"a\" {...{\n          \"aria-hidden\": \"true\",\n          \"focusable\": \"false\",\n          \"height\": \"16\",\n          \"version\": \"1.1\",\n          \"viewBox\": \"0 0 16 16\",\n          \"width\": \"16\"\n        }}><path parentName=\"svg\" {...{\n            \"fillRule\": \"evenodd\",\n            \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n          }}></path></svg></a>{`transferFrom`}</h2>\n    <p>{`Before swapping, our smart contracts needs to be in control of 50 DAI. The easiest way to accomplish this is by calling `}<inlineCode parentName=\"p\">{`transferFrom`}</inlineCode>{` on DAI with the owner set to `}<inlineCode parentName=\"p\">{`msg.sender`}</inlineCode>{`:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-solidity\"\n      }}>{`uint amountIn = 50 * 10 ** DAI.decimals();\nrequire(DAI.transferFrom(msg.sender, address(this), amountIn), 'transferFrom failed.');\n`}</code></pre>\n    <h2 {...{\n      \"id\": \"approve\",\n      \"style\": {\n        \"position\": \"relative\"\n      }\n    }}><a parentName=\"h2\" {...{\n        \"href\": \"#approve\",\n        \"aria-label\": \"approve permalink\",\n        \"className\": \"anchor before\"\n      }}><svg parentName=\"a\" {...{\n          \"aria-hidden\": \"true\",\n          \"focusable\": \"false\",\n          \"height\": \"16\",\n          \"version\": \"1.1\",\n          \"viewBox\": \"0 0 16 16\",\n          \"width\": \"16\"\n        }}><path parentName=\"svg\" {...{\n            \"fillRule\": \"evenodd\",\n            \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n          }}></path></svg></a>{`approve`}</h2>\n    <p>{`Now that our contract owns 50 DAI, we need to approve to the `}<Link to='/docs/v1/smart-contracts/router02' mdxType=\"Link\">{`router`}</Link>{` to withdraw this DAI:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-solidity\"\n      }}>{`require(DAI.approve(address(KwikswapV1Router02), amountIn), 'approve failed.');\n`}</code></pre>\n    <h2 {...{\n      \"id\": \"swapexacttokensforeth\",\n      \"style\": {\n        \"position\": \"relative\"\n      }\n    }}><a parentName=\"h2\" {...{\n        \"href\": \"#swapexacttokensforeth\",\n        \"aria-label\": \"swapexacttokensforeth permalink\",\n        \"className\": \"anchor before\"\n      }}><svg parentName=\"a\" {...{\n          \"aria-hidden\": \"true\",\n          \"focusable\": \"false\",\n          \"height\": \"16\",\n          \"version\": \"1.1\",\n          \"viewBox\": \"0 0 16 16\",\n          \"width\": \"16\"\n        }}><path parentName=\"svg\" {...{\n            \"fillRule\": \"evenodd\",\n            \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n          }}></path></svg></a>{`swapExactTokensForETH`}</h2>\n    <p>{`Now we’re ready to swap:`}</p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-solidity\"\n      }}>{`// amountOutMin must be retrieved from an oracle of some kind\naddress[] memory path = new address[](2);\npath[0] = address(DAI);\npath[1] = KwikswapV1Router02.WETH();\nKwikswapV1Router02.swapExactTokensForETH(amountIn, amountOutMin, path, msg.sender, block.timestamp);\n`}</code></pre>\n    <h1 {...{\n      \"id\": \"safety-considerations\",\n      \"style\": {\n        \"position\": \"relative\"\n      }\n    }}><a parentName=\"h1\" {...{\n        \"href\": \"#safety-considerations\",\n        \"aria-label\": \"safety considerations permalink\",\n        \"className\": \"anchor before\"\n      }}><svg parentName=\"a\" {...{\n          \"aria-hidden\": \"true\",\n          \"focusable\": \"false\",\n          \"height\": \"16\",\n          \"version\": \"1.1\",\n          \"viewBox\": \"0 0 16 16\",\n          \"width\": \"16\"\n        }}><path parentName=\"svg\" {...{\n            \"fillRule\": \"evenodd\",\n            \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n          }}></path></svg></a>{`Safety Considerations`}</h1>\n    <p>{`Because Ethereum transactions occur in an adversarial environment, smart contracts that do not perform safety checks `}<em parentName=\"p\">{`can be exploited for profit`}</em>{`. If a smart contract assumes that the current price on Kwikswap is a “fair” price without performing safety checks, `}<em parentName=\"p\">{`it is vulnerable to manipulation`}</em>{`. A bad actor could e.g. easily insert transactions before and after the swap (a “sandwich” attack) causing the smart contract to trade at a much worse price, profit from this at the trader’s expense, and then return the contracts to their original state. (One important caveat is that these types of attacks are mitigated by trading in extremely liquid pools, and/or at low values.)`}</p>\n    <p>{`The best way to protect against these attacks is to use an external price feed or “price oracle”. The best “oracle” is simply `}<em parentName=\"p\">{`traders’ off-chain observation of the current price`}</em>{`, which can be passed into the trade as a safety check. This strategy is best for situations `}<em parentName=\"p\">{`where users initiate trades on their own behalf`}</em>{`.`}</p>\n    <p>{`However, when an off-chain price can’t be used, an on-chain oracle should be used instead. Determining the best oracle for a given situation is a not part of this guide, but for more details on the Kwikswap approach to oracles, see `}<Link to='/docs/v1/core-concepts/oracles' mdxType=\"Link\">{`Oracles`}</Link>{`.`}</p>\n\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;"}}