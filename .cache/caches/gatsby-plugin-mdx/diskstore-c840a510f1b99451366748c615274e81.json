{"expireTime":9007200872306530000,"key":"gatsby-plugin-mdx-entire-payload-1ae84df52ba31a6f986aafa4d07aa499-","val":{"mdast":{"type":"root","children":[{"type":"import","value":"import DefaultLayout from \"C:/Developement/Assignment Tasks/Plasm/src/layouts/docs.js\"","position":{"start":{"line":3,"column":1,"offset":2},"end":{"line":3,"column":87,"offset":88},"indent":[]}},{"type":"export","default":true,"value":"export default DefaultLayout","position":{"start":{"line":5,"column":1,"offset":90},"end":{"line":5,"column":29,"offset":118},"indent":[]}},{"type":"heading","depth":1,"children":[{"type":"text","value":"Introduction","position":{"start":{"line":8,"column":3,"offset":124},"end":{"line":8,"column":15,"offset":136},"indent":[]}}],"position":{"start":{"line":8,"column":1,"offset":122},"end":{"line":8,"column":15,"offset":136},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Kwikswap enables building highly decentralized and manipulation-resistant on-chain price oracles.","position":{"start":{"line":10,"column":1,"offset":140},"end":{"line":10,"column":98,"offset":237},"indent":[]}}],"position":{"start":{"line":10,"column":1,"offset":140},"end":{"line":10,"column":98,"offset":237},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Price oracles are a crucial to the viability and security of DeFi protocols. Oracle designs between different projects have been implemented on an ad hoc basis, with varying degrees of decentralization and security. Because of this, the ecosystem has witnessed numerous high-profile hacks where the oracle implementation is the main attack vector.","position":{"start":{"line":12,"column":1,"offset":241},"end":{"line":12,"column":348,"offset":588},"indent":[]}}],"position":{"start":{"line":12,"column":1,"offset":241},"end":{"line":12,"column":348,"offset":588},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":" A lack of a robust price oracle has held back both the adoption of DeFi and made it difficult and costly for new entrants to launch new derivative products.","position":{"start":{"line":14,"column":1,"offset":592},"end":{"line":14,"column":158,"offset":749},"indent":[]}}],"position":{"start":{"line":14,"column":1,"offset":592},"end":{"line":14,"column":158,"offset":749},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Enter Kwikswap. As liquidity and trade volume on the protocol continue to grow, Kwikswap's on-chain trade history is becoming an evermore valuable, accurate, and robust source of price information. This insight has been formalized into the Price Oracle mechanism in Kwikswap.","position":{"start":{"line":16,"column":1,"offset":753},"end":{"line":16,"column":276,"offset":1028},"indent":[]}}],"position":{"start":{"line":16,"column":1,"offset":753},"end":{"line":16,"column":276,"offset":1028},"indent":[]}},{"type":"heading","depth":1,"children":[{"type":"text","value":"Why Oracles?","position":{"start":{"line":18,"column":3,"offset":1034},"end":{"line":18,"column":15,"offset":1046},"indent":[]}}],"position":{"start":{"line":18,"column":1,"offset":1032},"end":{"line":18,"column":15,"offset":1046},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"On-chain price feeds are a critical component for many decentralized financial applications including those similar to derivatives, lending, margin trading, prediction markets and more.","position":{"start":{"line":20,"column":1,"offset":1050},"end":{"line":20,"column":186,"offset":1235},"indent":[]}}],"position":{"start":{"line":20,"column":1,"offset":1050},"end":{"line":20,"column":186,"offset":1235},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Despite closely tracking the real-world price most of the time, Kwikswap V0 cannot be used safely as a price oracle. In Kwikswap V0, an attacker can simply manipulate the price just before it is measured.","position":{"start":{"line":22,"column":1,"offset":1239},"end":{"line":22,"column":205,"offset":1443},"indent":[]}}],"position":{"start":{"line":22,"column":1,"offset":1239},"end":{"line":22,"column":205,"offset":1443},"indent":[]}},{"type":"heading","depth":1,"children":[{"type":"text","value":"Kwikswap solution","position":{"start":{"line":24,"column":3,"offset":1449},"end":{"line":24,"column":20,"offset":1466},"indent":[]}}],"position":{"start":{"line":24,"column":1,"offset":1447},"end":{"line":24,"column":20,"offset":1466},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Kwikswap includes a number of improvements for price feeds built on top of it. First, every pair measures (but does not store) the market price at the beginning of each block, before any trades take place. This price is expensive to manipulate because it was set by the last transaction in a previous block.","position":{"start":{"line":26,"column":1,"offset":1470},"end":{"line":26,"column":308,"offset":1777},"indent":[]}}],"position":{"start":{"line":26,"column":1,"offset":1470},"end":{"line":26,"column":308,"offset":1777},"indent":[]}},{"type":"paragraph","children":[{"type":"strong","children":[{"type":"text","value":"To set the measured price to one that is out of sync with the global market price, an attacker has to make a bad trade at the end of a previous block","position":{"start":{"line":28,"column":3,"offset":1783},"end":{"line":28,"column":152,"offset":1932},"indent":[]}}],"position":{"start":{"line":28,"column":1,"offset":1781},"end":{"line":28,"column":154,"offset":1934},"indent":[]}},{"type":"text","value":" , typically with no guarantee that they will be able to arbitrage it back in the next block. Attackers will lose money to arbitrageurs, unless they can \"selfishly\" mine two blocks in a row. ","position":{"start":{"line":28,"column":154,"offset":1934},"end":{"line":28,"column":345,"offset":2125},"indent":[]}}],"position":{"start":{"line":28,"column":1,"offset":1781},"end":{"line":28,"column":345,"offset":2125},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"This alone is not enough. If significant value settles based on the price resulting from this mechanism, then the profit of an attack likely can outweigh the loss.","position":{"start":{"line":30,"column":1,"offset":2129},"end":{"line":30,"column":164,"offset":2292},"indent":[]}}],"position":{"start":{"line":30,"column":1,"offset":2129},"end":{"line":30,"column":164,"offset":2292},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Instead, Kwikswap adds this end-of-block price to a single cumulative-price variable in the core contract weighted by the amount of time this price existed. ","position":{"start":{"line":32,"column":1,"offset":2296},"end":{"line":32,"column":158,"offset":2453},"indent":[]}},{"type":"strong","children":[{"type":"text","value":"This variable represents a sum of the Kwikswap price for every second in the entire history of the contract.","position":{"start":{"line":32,"column":160,"offset":2455},"end":{"line":32,"column":268,"offset":2563},"indent":[]}}],"position":{"start":{"line":32,"column":158,"offset":2453},"end":{"line":32,"column":270,"offset":2565},"indent":[]}}],"position":{"start":{"line":32,"column":1,"offset":2296},"end":{"line":32,"column":270,"offset":2565},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"This variable can be used by external contracts to track accurate time-weighted average prices (TWAPs) across any time interval.","position":{"start":{"line":35,"column":1,"offset":2571},"end":{"line":35,"column":129,"offset":2699},"indent":[]}}],"position":{"start":{"line":35,"column":1,"offset":2571},"end":{"line":35,"column":129,"offset":2699},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"This is done by reading the cumulative price from an ERC20 token pair at the beginning and at the end of the interval. The difference in this cumulative price can then be divided by the length of the interval to create a TWAP for that period.","position":{"start":{"line":37,"column":1,"offset":2703},"end":{"line":37,"column":243,"offset":2945},"indent":[]}}],"position":{"start":{"line":37,"column":1,"offset":2703},"end":{"line":37,"column":243,"offset":2945},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"TWAPs can be used directly or as the basis for moving averages (EMAs and SMAs) as needed.","position":{"start":{"line":40,"column":1,"offset":2951},"end":{"line":40,"column":90,"offset":3040},"indent":[]}}],"position":{"start":{"line":40,"column":1,"offset":2951},"end":{"line":40,"column":90,"offset":3040},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"A few notes:","position":{"start":{"line":42,"column":1,"offset":3044},"end":{"line":42,"column":13,"offset":3056},"indent":[]}}],"position":{"start":{"line":42,"column":1,"offset":3044},"end":{"line":42,"column":13,"offset":3056},"indent":[]}},{"type":"list","ordered":false,"start":null,"spread":false,"children":[{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"For a 10-minute TWAP, sample once every 10 minutes. For a 1-week TWAP, sample once every week.","position":{"start":{"line":44,"column":3,"offset":3062},"end":{"line":44,"column":97,"offset":3156},"indent":[]}}],"position":{"start":{"line":44,"column":3,"offset":3062},"end":{"line":44,"column":97,"offset":3156},"indent":[]}}],"position":{"start":{"line":44,"column":1,"offset":3060},"end":{"line":44,"column":97,"offset":3156},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"For a simple TWAP, the cost of manipulation increases (approx. linear) with liquidity on Kwikswap, as well as (approx. linear) with the length of time over which you average.","position":{"start":{"line":45,"column":3,"offset":3160},"end":{"line":45,"column":177,"offset":3334},"indent":[]}}],"position":{"start":{"line":45,"column":3,"offset":3160},"end":{"line":45,"column":177,"offset":3334},"indent":[]}}],"position":{"start":{"line":45,"column":1,"offset":3158},"end":{"line":45,"column":177,"offset":3334},"indent":[]}},{"type":"listItem","spread":false,"checked":null,"children":[{"type":"paragraph","children":[{"type":"text","value":"Cost of an attack is relatively simple to estimate. Moving the price 5% on a 1-hour TWAP is approximately equal to the amount lost to arbitrage and fees for moving the price 5% every block for 1 hour.","position":{"start":{"line":46,"column":3,"offset":3338},"end":{"line":46,"column":203,"offset":3538},"indent":[]}}],"position":{"start":{"line":46,"column":3,"offset":3338},"end":{"line":46,"column":203,"offset":3538},"indent":[]}}],"position":{"start":{"line":46,"column":1,"offset":3336},"end":{"line":46,"column":203,"offset":3538},"indent":[]}}],"position":{"start":{"line":44,"column":1,"offset":3060},"end":{"line":46,"column":203,"offset":3538},"indent":[1,1]}},{"type":"paragraph","children":[{"type":"text","value":"There are some nuances that are good to be aware of when using Kwikswap as an oracle, especially where manipulation resistance is concerned. The ","position":{"start":{"line":48,"column":1,"offset":3542},"end":{"line":48,"column":146,"offset":3687},"indent":[]}},{"type":"jsx","value":"<a href='/whitepaper.pdf' target='_blank' rel='noopener noreferrer'>","position":{"start":{"line":48,"column":146,"offset":3687},"end":{"line":48,"column":214,"offset":3755},"indent":[]}},{"type":"text","value":"whitepaper","position":{"start":{"line":48,"column":214,"offset":3755},"end":{"line":48,"column":224,"offset":3765},"indent":[]}},{"type":"jsx","value":"</a>","position":{"start":{"line":48,"column":224,"offset":3765},"end":{"line":48,"column":228,"offset":3769},"indent":[]}},{"type":"text","value":" elaborates on some of them. Additional oracle-focused developer guides and documentation will be released soon.","position":{"start":{"line":48,"column":228,"offset":3769},"end":{"line":48,"column":340,"offset":3881},"indent":[]}}],"position":{"start":{"line":48,"column":1,"offset":3542},"end":{"line":48,"column":340,"offset":3881},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"In the meantime, check out our ","position":{"start":{"line":50,"column":1,"offset":3885},"end":{"line":50,"column":32,"offset":3916},"indent":[]}},{"type":"link","title":null,"url":"https://github.com/Kwikswap/Kwikswap-V1-Periphery/blob/master/contracts/examples/ExampleOracleSimple.sol","children":[{"type":"text","value":"example implementation","position":{"start":{"line":50,"column":33,"offset":3917},"end":{"line":50,"column":55,"offset":3939},"indent":[]}}],"position":{"start":{"line":50,"column":32,"offset":3916},"end":{"line":50,"column":162,"offset":4046},"indent":[]}},{"type":"text","value":" of a 24 hr TWAP Oracle built on Kwikswap!","position":{"start":{"line":50,"column":162,"offset":4046},"end":{"line":50,"column":204,"offset":4088},"indent":[]}}],"position":{"start":{"line":50,"column":1,"offset":3885},"end":{"line":50,"column":204,"offset":4088},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"In summary, Kwikswap introduces a 2 new variables in each pair, ","position":{"start":{"line":52,"column":1,"offset":4092},"end":{"line":52,"column":65,"offset":4156},"indent":[]}},{"type":"inlineCode","value":"price0CumulativeLast","position":{"start":{"line":52,"column":65,"offset":4156},"end":{"line":52,"column":87,"offset":4178},"indent":[]}},{"type":"text","value":" and ","position":{"start":{"line":52,"column":87,"offset":4178},"end":{"line":52,"column":92,"offset":4183},"indent":[]}},{"type":"inlineCode","value":"price1CumulativeLast","position":{"start":{"line":52,"column":92,"offset":4183},"end":{"line":52,"column":114,"offset":4205},"indent":[]}},{"type":"text","value":", that store the prices of ","position":{"start":{"line":52,"column":114,"offset":4205},"end":{"line":52,"column":141,"offset":4232},"indent":[]}},{"type":"inlineCode","value":"token0","position":{"start":{"line":52,"column":141,"offset":4232},"end":{"line":52,"column":149,"offset":4240},"indent":[]}},{"type":"text","value":" and ","position":{"start":{"line":52,"column":149,"offset":4240},"end":{"line":52,"column":154,"offset":4245},"indent":[]}},{"type":"inlineCode","value":"token1","position":{"start":{"line":52,"column":154,"offset":4245},"end":{"line":52,"column":162,"offset":4253},"indent":[]}},{"type":"text","value":" respectively, multiplied by for how long they were observed (in seconds). These variables are cumulative, meaning they are ever-increasing. They are updated with the first ","position":{"start":{"line":52,"column":162,"offset":4253},"end":{"line":52,"column":335,"offset":4426},"indent":[]}},{"type":"inlineCode","value":"swap","position":{"start":{"line":52,"column":335,"offset":4426},"end":{"line":52,"column":341,"offset":4432},"indent":[]}},{"type":"text","value":"/","position":{"start":{"line":52,"column":341,"offset":4432},"end":{"line":52,"column":342,"offset":4433},"indent":[]}},{"type":"inlineCode","value":"mint","position":{"start":{"line":52,"column":342,"offset":4433},"end":{"line":52,"column":348,"offset":4439},"indent":[]}},{"type":"text","value":"/","position":{"start":{"line":52,"column":348,"offset":4439},"end":{"line":52,"column":349,"offset":4440},"indent":[]}},{"type":"inlineCode","value":"burn","position":{"start":{"line":52,"column":349,"offset":4440},"end":{"line":52,"column":355,"offset":4446},"indent":[]}},{"type":"text","value":" of each block.","position":{"start":{"line":52,"column":355,"offset":4446},"end":{"line":52,"column":370,"offset":4461},"indent":[]}}],"position":{"start":{"line":52,"column":1,"offset":4092},"end":{"line":52,"column":370,"offset":4461},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"You can use these either of these new variables to compute an average price between 2 observations. To do so, take the difference (i.e. subtraction) of two observations, and divide by the time elapsed between them. This is the basis of building oracles on top of.","position":{"start":{"line":54,"column":1,"offset":4465},"end":{"line":54,"column":264,"offset":4728},"indent":[]}}],"position":{"start":{"line":54,"column":1,"offset":4465},"end":{"line":54,"column":264,"offset":4728},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Manipulation resistance","position":{"start":{"line":56,"column":4,"offset":4735},"end":{"line":56,"column":27,"offset":4758},"indent":[]}}],"position":{"start":{"line":56,"column":1,"offset":4732},"end":{"line":56,"column":27,"offset":4758},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"The cost of manipulating the price for a specific time period can be roughly estimated as the amount lost to arbitrage and fees every block for the entire period. For larger liquidity pools and over longer time periods, this attack is impractical, as the cost of manipulation typically exceeds the value at stake.","position":{"start":{"line":58,"column":1,"offset":4762},"end":{"line":58,"column":314,"offset":5075},"indent":[]}}],"position":{"start":{"line":58,"column":1,"offset":4762},"end":{"line":58,"column":314,"offset":5075},"indent":[]}},{"type":"heading","depth":2,"children":[{"type":"text","value":"Using Kwikswap price oracles","position":{"start":{"line":60,"column":4,"offset":5082},"end":{"line":60,"column":32,"offset":5110},"indent":[]}}],"position":{"start":{"line":60,"column":1,"offset":5079},"end":{"line":60,"column":32,"offset":5110},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"Importantly, Kwikswap is not opinionated on how you use the new cumulative price variables, allowing you to build oracles that compute different kinds of price averages and over different periods.","position":{"start":{"line":62,"column":1,"offset":5114},"end":{"line":62,"column":197,"offset":5310},"indent":[]}}],"position":{"start":{"line":62,"column":1,"offset":5114},"end":{"line":62,"column":197,"offset":5310},"indent":[]}},{"type":"heading","depth":1,"children":[{"type":"text","value":"Building an oracle","position":{"start":{"line":64,"column":3,"offset":5316},"end":{"line":64,"column":21,"offset":5334},"indent":[]}}],"position":{"start":{"line":64,"column":1,"offset":5314},"end":{"line":64,"column":21,"offset":5334},"indent":[]}},{"type":"paragraph","children":[{"type":"text","value":"To learn more about building oracles check out ","position":{"start":{"line":66,"column":1,"offset":5338},"end":{"line":66,"column":48,"offset":5385},"indent":[]}},{"type":"jsx","value":"<Link to=\"/docs/v1/smart-contract-integration/building-an-oracle/\">","position":{"start":{"line":66,"column":48,"offset":5385},"end":{"line":66,"column":115,"offset":5452},"indent":[]}},{"type":"text","value":"building an oracle","position":{"start":{"line":66,"column":115,"offset":5452},"end":{"line":66,"column":133,"offset":5470},"indent":[]}},{"type":"jsx","value":"</Link>","position":{"start":{"line":66,"column":133,"offset":5470},"end":{"line":66,"column":140,"offset":5477},"indent":[]}},{"type":"text","value":" in the developer guides.","position":{"start":{"line":66,"column":140,"offset":5477},"end":{"line":66,"column":165,"offset":5502},"indent":[]}}],"position":{"start":{"line":66,"column":1,"offset":5338},"end":{"line":66,"column":165,"offset":5502},"indent":[]}},{"type":"export","value":"export const _frontmatter = {}","position":{"start":{"line":69,"column":1,"offset":5506},"end":{"line":69,"column":31,"offset":5536},"indent":[]}}],"position":{"start":{"line":1,"column":1,"offset":0},"end":{"line":69,"column":31,"offset":5536}}},"scopeImports":[],"scopeIdentifiers":[],"rawMDXOutput":"/* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsxRuntime classic */\n/* @jsx mdx */\nimport DefaultLayout from \"C:/Developement/Assignment Tasks/Plasm/src/layouts/docs.js\"\nexport const _frontmatter = {};\nconst makeShortcode = name => function MDXDefaultShortcode(props) {\n      console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\")\n      return <div {...props}/>\n    };\nconst Link = makeShortcode(\"Link\");\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <h1 {...{\n      \"id\": \"introduction\",\n      \"style\": {\n        \"position\": \"relative\"\n      }\n    }}><a parentName=\"h1\" {...{\n        \"href\": \"#introduction\",\n        \"aria-label\": \"introduction permalink\",\n        \"className\": \"anchor before\"\n      }}><svg parentName=\"a\" {...{\n          \"aria-hidden\": \"true\",\n          \"focusable\": \"false\",\n          \"height\": \"16\",\n          \"version\": \"1.1\",\n          \"viewBox\": \"0 0 16 16\",\n          \"width\": \"16\"\n        }}><path parentName=\"svg\" {...{\n            \"fillRule\": \"evenodd\",\n            \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n          }}></path></svg></a>{`Introduction`}</h1>\n    <p>{`Kwikswap enables building highly decentralized and manipulation-resistant on-chain price oracles.`}</p>\n    <p>{`Price oracles are a crucial to the viability and security of DeFi protocols. Oracle designs between different projects have been implemented on an ad hoc basis, with varying degrees of decentralization and security. Because of this, the ecosystem has witnessed numerous high-profile hacks where the oracle implementation is the main attack vector.`}</p>\n    <p>{` A lack of a robust price oracle has held back both the adoption of DeFi and made it difficult and costly for new entrants to launch new derivative products.`}</p>\n    <p>{`Enter Kwikswap. As liquidity and trade volume on the protocol continue to grow, Kwikswap’s on-chain trade history is becoming an evermore valuable, accurate, and robust source of price information. This insight has been formalized into the Price Oracle mechanism in Kwikswap.`}</p>\n    <h1 {...{\n      \"id\": \"why-oracles\",\n      \"style\": {\n        \"position\": \"relative\"\n      }\n    }}><a parentName=\"h1\" {...{\n        \"href\": \"#why-oracles\",\n        \"aria-label\": \"why oracles permalink\",\n        \"className\": \"anchor before\"\n      }}><svg parentName=\"a\" {...{\n          \"aria-hidden\": \"true\",\n          \"focusable\": \"false\",\n          \"height\": \"16\",\n          \"version\": \"1.1\",\n          \"viewBox\": \"0 0 16 16\",\n          \"width\": \"16\"\n        }}><path parentName=\"svg\" {...{\n            \"fillRule\": \"evenodd\",\n            \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n          }}></path></svg></a>{`Why Oracles?`}</h1>\n    <p>{`On-chain price feeds are a critical component for many decentralized financial applications including those similar to derivatives, lending, margin trading, prediction markets and more.`}</p>\n    <p>{`Despite closely tracking the real-world price most of the time, Kwikswap V0 cannot be used safely as a price oracle. In Kwikswap V0, an attacker can simply manipulate the price just before it is measured.`}</p>\n    <h1 {...{\n      \"id\": \"kwikswap-solution\",\n      \"style\": {\n        \"position\": \"relative\"\n      }\n    }}><a parentName=\"h1\" {...{\n        \"href\": \"#kwikswap-solution\",\n        \"aria-label\": \"kwikswap solution permalink\",\n        \"className\": \"anchor before\"\n      }}><svg parentName=\"a\" {...{\n          \"aria-hidden\": \"true\",\n          \"focusable\": \"false\",\n          \"height\": \"16\",\n          \"version\": \"1.1\",\n          \"viewBox\": \"0 0 16 16\",\n          \"width\": \"16\"\n        }}><path parentName=\"svg\" {...{\n            \"fillRule\": \"evenodd\",\n            \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n          }}></path></svg></a>{`Kwikswap solution`}</h1>\n    <p>{`Kwikswap includes a number of improvements for price feeds built on top of it. First, every pair measures (but does not store) the market price at the beginning of each block, before any trades take place. This price is expensive to manipulate because it was set by the last transaction in a previous block.`}</p>\n    <p><strong parentName=\"p\">{`To set the measured price to one that is out of sync with the global market price, an attacker has to make a bad trade at the end of a previous block`}</strong>{` , typically with no guarantee that they will be able to arbitrage it back in the next block. Attackers will lose money to arbitrageurs, unless they can “selfishly” mine two blocks in a row. `}</p>\n    <p>{`This alone is not enough. If significant value settles based on the price resulting from this mechanism, then the profit of an attack likely can outweigh the loss.`}</p>\n    <p>{`Instead, Kwikswap adds this end-of-block price to a single cumulative-price variable in the core contract weighted by the amount of time this price existed. `}<strong parentName=\"p\">{`This variable represents a sum of the Kwikswap price for every second in the entire history of the contract.`}</strong></p>\n    <p>{`This variable can be used by external contracts to track accurate time-weighted average prices (TWAPs) across any time interval.`}</p>\n    <p>{`This is done by reading the cumulative price from an ERC20 token pair at the beginning and at the end of the interval. The difference in this cumulative price can then be divided by the length of the interval to create a TWAP for that period.`}</p>\n    <p>{`TWAPs can be used directly or as the basis for moving averages (EMAs and SMAs) as needed.`}</p>\n    <p>{`A few notes:`}</p>\n    <ul>\n      <li parentName=\"ul\">{`For a 10-minute TWAP, sample once every 10 minutes. For a 1-week TWAP, sample once every week.`}</li>\n      <li parentName=\"ul\">{`For a simple TWAP, the cost of manipulation increases (approx. linear) with liquidity on Kwikswap, as well as (approx. linear) with the length of time over which you average.`}</li>\n      <li parentName=\"ul\">{`Cost of an attack is relatively simple to estimate. Moving the price 5% on a 1-hour TWAP is approximately equal to the amount lost to arbitrage and fees for moving the price 5% every block for 1 hour.`}</li>\n    </ul>\n    <p>{`There are some nuances that are good to be aware of when using Kwikswap as an oracle, especially where manipulation resistance is concerned. The `}<a href='/whitepaper.pdf' target='_blank' rel='noopener noreferrer'>{`whitepaper`}</a>{` elaborates on some of them. Additional oracle-focused developer guides and documentation will be released soon.`}</p>\n    <p>{`In the meantime, check out our `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/Kwikswap/Kwikswap-V1-Periphery/blob/master/contracts/examples/ExampleOracleSimple.sol\"\n      }}>{`example implementation`}</a>{` of a 24 hr TWAP Oracle built on Kwikswap!`}</p>\n    <p>{`In summary, Kwikswap introduces a 2 new variables in each pair, `}<inlineCode parentName=\"p\">{`price0CumulativeLast`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`price1CumulativeLast`}</inlineCode>{`, that store the prices of `}<inlineCode parentName=\"p\">{`token0`}</inlineCode>{` and `}<inlineCode parentName=\"p\">{`token1`}</inlineCode>{` respectively, multiplied by for how long they were observed (in seconds). These variables are cumulative, meaning they are ever-increasing. They are updated with the first `}<inlineCode parentName=\"p\">{`swap`}</inlineCode>{`/`}<inlineCode parentName=\"p\">{`mint`}</inlineCode>{`/`}<inlineCode parentName=\"p\">{`burn`}</inlineCode>{` of each block.`}</p>\n    <p>{`You can use these either of these new variables to compute an average price between 2 observations. To do so, take the difference (i.e. subtraction) of two observations, and divide by the time elapsed between them. This is the basis of building oracles on top of.`}</p>\n    <h2 {...{\n      \"id\": \"manipulation-resistance\",\n      \"style\": {\n        \"position\": \"relative\"\n      }\n    }}><a parentName=\"h2\" {...{\n        \"href\": \"#manipulation-resistance\",\n        \"aria-label\": \"manipulation resistance permalink\",\n        \"className\": \"anchor before\"\n      }}><svg parentName=\"a\" {...{\n          \"aria-hidden\": \"true\",\n          \"focusable\": \"false\",\n          \"height\": \"16\",\n          \"version\": \"1.1\",\n          \"viewBox\": \"0 0 16 16\",\n          \"width\": \"16\"\n        }}><path parentName=\"svg\" {...{\n            \"fillRule\": \"evenodd\",\n            \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n          }}></path></svg></a>{`Manipulation resistance`}</h2>\n    <p>{`The cost of manipulating the price for a specific time period can be roughly estimated as the amount lost to arbitrage and fees every block for the entire period. For larger liquidity pools and over longer time periods, this attack is impractical, as the cost of manipulation typically exceeds the value at stake.`}</p>\n    <h2 {...{\n      \"id\": \"using-kwikswap-price-oracles\",\n      \"style\": {\n        \"position\": \"relative\"\n      }\n    }}><a parentName=\"h2\" {...{\n        \"href\": \"#using-kwikswap-price-oracles\",\n        \"aria-label\": \"using kwikswap price oracles permalink\",\n        \"className\": \"anchor before\"\n      }}><svg parentName=\"a\" {...{\n          \"aria-hidden\": \"true\",\n          \"focusable\": \"false\",\n          \"height\": \"16\",\n          \"version\": \"1.1\",\n          \"viewBox\": \"0 0 16 16\",\n          \"width\": \"16\"\n        }}><path parentName=\"svg\" {...{\n            \"fillRule\": \"evenodd\",\n            \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n          }}></path></svg></a>{`Using Kwikswap price oracles`}</h2>\n    <p>{`Importantly, Kwikswap is not opinionated on how you use the new cumulative price variables, allowing you to build oracles that compute different kinds of price averages and over different periods.`}</p>\n    <h1 {...{\n      \"id\": \"building-an-oracle\",\n      \"style\": {\n        \"position\": \"relative\"\n      }\n    }}><a parentName=\"h1\" {...{\n        \"href\": \"#building-an-oracle\",\n        \"aria-label\": \"building an oracle permalink\",\n        \"className\": \"anchor before\"\n      }}><svg parentName=\"a\" {...{\n          \"aria-hidden\": \"true\",\n          \"focusable\": \"false\",\n          \"height\": \"16\",\n          \"version\": \"1.1\",\n          \"viewBox\": \"0 0 16 16\",\n          \"width\": \"16\"\n        }}><path parentName=\"svg\" {...{\n            \"fillRule\": \"evenodd\",\n            \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n          }}></path></svg></a>{`Building an oracle`}</h1>\n    <p>{`To learn more about building oracles check out `}<Link to=\"/docs/v1/smart-contract-integration/building-an-oracle/\" mdxType=\"Link\">{`building an oracle`}</Link>{` in the developer guides.`}</p>\n\n    </MDXLayout>;\n}\n\n;\nMDXContent.isMDXComponent = true;"}}